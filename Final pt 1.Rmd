---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
#Load Data
library(readr)
loans50k <- read_csv("loans50k.csv")
View(loans50k)
```
```{r}
library(tidyr)
library(dplyr)
#Make new variable: Set "Good" and "Bad" Loans, all else "blank" to be removed later
df <-
  loans50k %>%
  mutate(payment_status = case_when(
    status == "Fully Paid" ~ "Good", 
    status == "Charged Off" ~ "Bad",
    TRUE ~ ""
  ))

#change the empty string cells to NAs
df[df==""]<-NA

#Test where all NAs are to 
which(is.na(df), arr.ind=TRUE)
#Found a bunch in "employment". Going to eliminate on account of too many levels/NA values.  
df$employment<- NULL

```

```{r}
#Probably best to get rid of the null values we aren't interested in payment_status:
df<-df %>% drop_na(payment_status)

#Test where the NAs are again:
which(is.na(df), arr.ind=TRUE)

#Row 34806 is missing all values, eliminate and test again:
df <- df[-c(34806),] 
which(is.na(df), arr.ind=TRUE)
#last NA values are in bcOpen and bcRatio, of which there are roughtly 400 incomplete entries, 
#or roughly 1% of the dataset. Eliminating these wont be a huge issue. 

#Finally omit all the rows containing NA values. (This will not eliminate the NA values in "length" as they are strings)
df1<-na.omit(df)


#consolidate "verified" variable into two levels instead of three
library(plyr)
df1$verified<-revalue(df1$verified, c("Source Verified"="Verified"))
unique(df1$verified)

```

```{r}
#make subset of numerical data check covariance matrix on numeric factors. 
dfNum<-select_if(df1, is.numeric)
cor(dfNum)
#Found few redundant variables...will eliminate: 

#Final check for number of levels in each categorical variable
dfChar<-select_if(df1,is.character) 
sapply((sapply(dfChar,unique)),length)


#Eliminating: totalPaid, employment (already done), payment,revolRatio, avgBal, totalLim,state,status,loanID
df_New = as.data.frame(subset(df1, select = -c(totalPaid, payment,revolRatio, avgBal, totalLim,state,status,loanID)))

```


```{r}

library("ggplot2")
sapply(df_New, hist)
```

```{r}

```

```
```{r}
#Eventually...
mylogit <- glm(as.factor(payment_status) ~ ., data = df_New, family = "binomial")


```

```{r}

```


